name: Version Check

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  check-version:
    name: Check version consistency
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Check version matches
      run: |
        # Extract version from gleam.toml
        GLEAM_VERSION=$(grep '^version' gleam.toml | sed 's/version = "\(.*\)"/\1/')
        echo "gleam.toml version: $GLEAM_VERSION"

        # Extract version from source code
        SOURCE_VERSION=$(grep '^const version' src/caffeine_lang.gleam | sed 's/const version = "\(.*\)"/\1/')
        echo "Source code version: $SOURCE_VERSION"

        # Compare versions
        if [ "$GLEAM_VERSION" != "$SOURCE_VERSION" ]; then
          echo ""
          echo "❌ Version mismatch!"
          echo "   gleam.toml:           $GLEAM_VERSION"
          echo "   caffeine_lang.gleam:  $SOURCE_VERSION"
          echo ""
          echo "Please update the version constant in src/caffeine_lang.gleam to match gleam.toml"
          exit 1
        fi

        echo ""
        echo "✅ Versions match: $GLEAM_VERSION"
